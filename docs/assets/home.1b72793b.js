var ue=Object.defineProperty;var be=(e,t,o)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var w=(e,t,o)=>(be(e,typeof t!="symbol"?t+"":t,o),o);import{o as l,c as p,aj as pe,ak as me,a as n,C as ye,r as u,w as he,Y as ge,n as C,f as ve,u as i,L as V,S as b,Q as g,M as F,ab as U,x as D,ac as _e,s as we,al as B,U as fe,P as G,a9 as je}from"./@vue.14a7b677.js";import{_ as xe}from"./index.b6f859b3.js";import{C as N}from"./crypto-js.22cfcac2.js";import{E,a as k,b as H,c as Se,d as Ce,e as De}from"./element-plus.d2cfb5b0.js";import{H as I,j as Be,p as ke,g as Ee,a as Ie,r as Te,s as Ne,b as Ke,c as Me,l as Re,d as Ve,x as Fe,e as Ae,f as Le,h as $e}from"./highlight.js.243975e6.js";import{m as Z,_ as Pe}from"./marked.71c0c359.js";import{S as Oe}from"./smooth-scroll.5dc190f0.js";import"./vue-router.59776677.js";import"./@element-plus.df50e9cf.js";import"./@ctrl.b082b0c1.js";import"./@vueuse.f2d0f84a.js";import"./@popperjs.36402333.js";import"./lodash-es.6aaf5ee5.js";const qe="/Vue3-TS-ChatGPT/assets/3.c13c7547.svg",A=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),W=[{role:"system",content:"I want you to act as a professional programmer, providing rigorous and comprehensible answers to my questions. When I present you with a programming query or scenario, respond with the precision and clarity expected of an experienced developer. Ensure your explanations are thorough yet easy to understand, employing technical terminology accurately. Your responses should reflect the expertise and insight of a seasoned programmer, aiding in not just solving the presented issue, but also offering a deeper understanding of the underlying concepts involved."},{role:"assistant",content:"\u4F60\u597D\uFF0C\u6211\u662F\u795E\u5947\u6D77\u87BA\uFF0C\u6B22\u8FCE\u63D0\u95EE"}],f=class{constructor(){w(this,"dbName","ChatAppDB");w(this,"objectStoreName","chatRecords");w(this,"chatRecordKey","chatRecordKey");w(this,"isIndexedDBSupported","indexedDB"in window)}static getInstance(){return f.instance||(f.instance=new f),f.instance}initDB(){return new Promise((t,o)=>{const c=indexedDB.open(this.dbName,1);c.onerror=m=>{o("Failed to open IndexedDB")},c.onsuccess=m=>{t(m.target.result)},c.onupgradeneeded=m=>{const j=m.target.result;j.objectStoreNames.contains(this.objectStoreName)||j.createObjectStore(this.objectStoreName)}})}async saveChatRecord(t){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).put(t,this.chatRecordKey):localStorage.setItem(this.chatRecordKey,JSON.stringify(t))}async getChatRecord(){if(this.isIndexedDBSupported){const t=await this.initDB();return new Promise((o,c)=>{const r=t.transaction([this.objectStoreName]).objectStore(this.objectStoreName).get(this.chatRecordKey);r.onerror=v=>{c("Failed to fetch record from IndexedDB")},r.onsuccess=v=>{o(r.result)}})}else{const t=localStorage.getItem(this.chatRecordKey);return t?JSON.parse(t):null}}async deleteChatRecord(){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).delete(this.chatRecordKey):localStorage.removeItem(this.chatRecordKey)}};let T=f;w(T,"instance");const ze={},Je=e=>(pe("data-v-107fce48"),e=e(),me(),e),Ue={class:"box"},Ge=Je(()=>n("div",{class:"loading"},[n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div")],-1)),He=[Ge];function We(e,t){return l(),p("div",Ue,He)}const Ye=xe(ze,[["render",We],["__scopeId","data-v-107fce48"]]);async function Qe(e,t,o){try{return{status:"success",data:(await fetch("https://api.openai.com/v1/chat/completions",{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,stream:!0,messages:e})})).body}}catch(c){return{status:"error",message:c}}}const ee="SuMingcheng";N.enc.Utf8.parse("ThisIsAnIV123456");function Xe(e){return N.AES.encrypt(e,ee).toString()}function Ze(e){return e==null?"":N.AES.decrypt(e,ee).toString(N.enc.Utf8)}const et=new TextDecoder("utf-8"),Y={get(e){return Ze(window.localStorage.getItem(e))},set(e,t){window.localStorage.setItem(e,Xe(t))},remove(e){window.localStorage.removeItem(e)}},Q=()=>{window.open("https://github.com/sumingcheng/Vue3-TS-ChatGPT")};function tt(e){const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return e.sort((o,c)=>t.compare(o.id,c.id))}function ot(){return{getKey:()=>{const o=Y.get("apiKey");return o===null?"":o},setKey:o=>Y.set("apiKey",o)}}const at=e=>{navigator.clipboard.writeText(e).then(function(){E({message:"\u5DF2\u590D\u5236",type:"success"})},function(t){console.error("\u65E0\u6CD5\u590D\u5236\u6587\u672C: ",t)})},X=()=>{const e=document.getElementsByClassName("copyNode");Array.from(e).forEach(o=>{o.copyAction&&o.removeEventListener("click",o.copyAction),o.copyAction=()=>{at(o.nextSibling.textContent)},o.addEventListener("click",o.copyAction)})},K=new Pe,st={javascript:Be,python:ke,go:Ee,java:Ie,rust:Te,shell:Ne,php:Ke,sql:Me,less:Re,css:Ve,xml:Fe,json:Ae,c:Le,cpp:$e};for(const[e,t]of Object.entries(st))I.registerLanguage(e,t);K.text=function(e){return e.startsWith("$")&&e.endsWith("$")?`<span class='math'>${e.slice(1,-1)}</span>`:e};K.paragraph=function(e){return e.startsWith("$$")&&e.endsWith("$$")?`<div class='math'>${e.slice(2,-2)}</div>`:"<p>"+e+`</p>
`};K.code=(e,t)=>{const c=!!(t&&I.getLanguage(t))?I.highlight(e,{language:t}).value:I.highlightAuto(e).value;return`<pre class='clearfix'><button class='copyNode'>Copy</button><code class='${t} hljs'>${c}</code></pre>
`};Z.setOptions({renderer:K});const nt=e=>Z(e),dt=[{id:"text-search-babbage-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k-0613",object:"model",created:1685474247,owned_by:"openai"},{id:"curie-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k",object:"model",created:1683758102,owned_by:"openai-internal"},{id:"text-search-babbage-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"babbage",object:"model",created:1649358449,owned_by:"openai"},{id:"babbage-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-babbage-001",object:"model",created:1649364043,owned_by:"openai"},{id:"text-similarity-davinci-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-1106-preview",object:"model",created:1698957206,owned_by:"system"},{id:"davinci-similarity",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-davinci-edit-001",object:"model",created:1649880484,owned_by:"openai"},{id:"curie-similarity",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"babbage-search-document",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"curie-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"gpt-3.5-turbo",object:"model",created:1677610602,owned_by:"openai"},{id:"gpt-3.5-turbo-1106",object:"model",created:1698959748,owned_by:"system"},{id:"text-search-ada-doc-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"davinci-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"text-similarity-babbage-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-search-davinci-doc-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-similarity",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-embedding-ada-002",object:"model",created:1671217299,owned_by:"openai-internal"},{id:"davinci-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-vision-preview",object:"model",created:1698894917,owned_by:"system"},{id:"text-similarity-curie-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"gpt-4",object:"model",created:1687882411,owned_by:"openai"},{id:"text-davinci-001",object:"model",created:1649364042,owned_by:"openai"},{id:"text-search-davinci-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-search-document",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-code-search-code",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-002",object:"model",created:1692634615,owned_by:"system"},{id:"davinci-002",object:"model",created:1692634301,owned_by:"system"},{id:"davinci-search-document",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"curie-search-document",object:"model",created:1651172508,owned_by:"openai-dev"},{id:"babbage-code-search-code",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-search-ada-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"code-search-ada-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"babbage-code-search-text",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-search-babbage-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-code-search-text",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"tts-1-hd",object:"model",created:1699046015,owned_by:"system"},{id:"text-search-curie-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-002",object:"model",created:1649880484,owned_by:"openai"},{id:"text-davinci-edit-001",object:"model",created:1649809179,owned_by:"openai"},{id:"code-search-babbage-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"tts-1-hd-1106",object:"model",created:1699053533,owned_by:"system"},{id:"gpt-3.5-turbo-instruct-0914",object:"model",created:1694122472,owned_by:"system"},{id:"ada",object:"model",created:1649357491,owned_by:"openai"},{id:"gpt-3.5-turbo-0613",object:"model",created:1686587434,owned_by:"openai"},{id:"text-ada-001",object:"model",created:1649364042,owned_by:"openai"},{id:"ada-similarity",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"code-search-ada-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"text-similarity-ada-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-0301",object:"model",created:1677649963,owned_by:"openai"},{id:"gpt-3.5-turbo-instruct",object:"model",created:1692901427,owned_by:"system"},{id:"gpt-4-0613",object:"model",created:1686588896,owned_by:"openai"},{id:"text-search-curie-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-003",object:"model",created:1669599635,owned_by:"openai-internal"},{id:"text-curie-001",object:"model",created:1649364043,owned_by:"openai"},{id:"whisper-1",object:"model",created:1677532384,owned_by:"openai-internal"},{id:"curie",object:"model",created:1649359874,owned_by:"openai"},{id:"gpt-4-0314",object:"model",created:1687882410,owned_by:"openai"},{id:"canary-tts",object:"model",created:1699492935,owned_by:"system"},{id:"tts-1",object:"model",created:1681940951,owned_by:"openai-internal"},{id:"davinci",object:"model",created:1649359874,owned_by:"openai"},{id:"dall-e-2",object:"model",created:1698798177,owned_by:"system"},{id:"tts-1-1106",object:"model",created:1699053241,owned_by:"system"},{id:"dall-e-3",object:"model",created:1698785189,owned_by:"system"}],it={class:"flex flex-col h-screen relative"},ct={class:"flex flex-nowrap fixed w-full items-baseline top-0 px-6 py-4 bgColor z-50"},rt=n("div",{class:"text-2xl font-bold text-white"},"MagicConch",-1),lt={key:0,class:"ml-4 text-sm text-white"},ut=n("img",{loading:"lazy",src:"https://img.shields.io/github/stars/sumingcheng/Vue3-TS-ChatGPT?logo=github",alt:"GitHub"},null,-1),bt=[ut],pt={class:"flex-1 mt-16 content",ref:"observedDiv"},mt={class:"font-bold mb-3 text-lg"},yt=["innerHTML"],ht={class:"flex flex-nowrap fixed w-full p-6 bgColor bottom-0 z-50"},gt={class:"flex items-center w-full"},vt=n("img",{src:qe,alt:"ReturnToBottom"},null,-1),_t=[vt],wt={class:"bottom-0 w-full p-6 pb-8"},ft={class:"flex items-center"},jt=n("span",{class:"w-1/6 font-bold"},"API Key",-1),xt={class:"flex items-center mt-5"},St=n("span",{class:"w-1/6 font-bold"},"Version",-1),Lt=ye({__name:"home",setup(e){const t=tt(dt),o=T.getInstance(),{getKey:c,setKey:m}=ot(),j={user:"ME",assistant:"Magic Conch",system:"System"},r=u(W),v=u("gpt-3.5-turbo");let M=u(!1);const R=u(null),y=u(!1),L=u();u(!1);let _=u(""),h=u("");const $=()=>{window.MathJax?te():setTimeout($,100)},te=()=>{we(()=>{r.value.forEach(d=>{d.content&&d.content.includes("$")&&C(()=>{window.MathJax.typesetPromise()})})})},oe=()=>{if(!h.value){E({message:"\u8BF7\u8F93\u5165API Key",type:"warning"});return}m(h.value),E({message:"\u4FDD\u5B58\u6210\u529F",type:"success"}),y.value=!1},ae=()=>{_.value=""},P=d=>{r.value[r.value.length-1].content+=d},se=async d=>{try{const a=d.data.getReader();await O(a)}catch(a){console.error("Error updating message list:",a)}},O=async d=>{const{done:a,value:x}=await d.read();if(a){d.releaseLock();return}const s=et.decode(x).match(/data: \s*({.*?}]})/g);s&&(s.forEach(ce=>{var J;const re=ce.replace("data: ",""),le=JSON.parse(re);P((J=le.choices[0].delta.content)!=null?J:"")}),await C(()=>{S()})),await O(d)},q=async(d=_.value)=>{if(!d){E({message:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"info"});return}M.value=!0,r.value.length===2&&r.value.pop(),r.value.push({role:"user",content:d}),ae(),r.value.push({role:"assistant",content:""});const a=await Qe(r.value,c(),v.value);a.status==="success"&&a.data?await se(a):P(a.message),M.value=!1,z();const x=JSON.stringify(r.value),s=JSON.parse(x);o.saveChatRecord(s).then(()=>{console.log("Chat records saved successfully!")})},z=()=>{C(()=>{R.value&&R.value.focus()})},ne=()=>{y.value=!0;let d=c();d&&(h.value=d)},S=()=>{const d=new Oe,a=L.value;a&&d.animateScroll(a.scrollHeight,a)},de=()=>{o.deleteChatRecord().then(()=>{console.log("Chat records deleted successfully!")}),r.value=W},ie=async()=>{const d=await o.getChatRecord();d&&(r.value=d,S())};return he(r.value,()=>{console.log("goToTheBottom()",r.value),S()},{deep:!0,immediate:!0}),ge(()=>{C(()=>{X()})}),ve(()=>{c()===""&&(y.value=!0),z(),ie(),$(),X()}),(d,a)=>{const x=je("DeleteFilled");return l(),p(F,null,[n("div",it,[n("div",ct,[rt,i(A)?V("",!0):(l(),p("div",lt," Magic conch based on ChatGPT ")),i(A)?V("",!0):(l(),p("div",{key:1,class:"ml-4 my-auto cursor-pointer",onClick:a[0]||(a[0]=(...s)=>i(Q)&&i(Q)(...s))},bt)),n("div",{class:"ml-auto text-sm cursor-pointer",onClick:ne},[b(i(k),{size:"large",type:"info",class:"elBtnStyle text-4xl"},{default:g(()=>[B("Settings")]),_:1})])]),n("div",pt,[n("div",{class:"mx-10 mt-6 mb-24",ref_key:"chatListDom",ref:L},[(l(!0),p(F,null,U(i(r).filter(s=>s.role!=="system"),s=>(l(),p("div",null,[n("div",mt,fe(j[s.role])+"\uFF1A",1),s.content?(l(),p("div",{key:0,class:"text-base text-black whitespace-pre-wrap",innerHTML:i(nt)(s.content.replace(/^\n\n/,""))},null,8,yt)):(l(),G(Ye,{key:1}))]))),256))],512)],512),n("div",ht,[n("div",gt,[b(i(H),{class:"input",rows:1,type:"textarea",ref_key:"myInput",ref:R,modelValue:i(_),"onUpdate:modelValue":a[1]||(a[1]=s=>D(_)?_.value=s:_=s),size:"large",onKeydown:a[2]||(a[2]=_e(s=>q(),["enter"])),disabled:i(M)},null,8,["modelValue","disabled"]),b(i(k),{onClick:a[3]||(a[3]=s=>q()),size:"large",type:"info",class:"elBtnStyle text-5xl ml-5"},{default:g(()=>[B("Send")]),_:1}),n("div",{class:"triangle ml-4 cursor-pointer",onClick:de},[b(x)]),i(A)?V("",!0):(l(),p("div",{key:0,class:"triangle ml-4 cursor-pointer",onClick:S},_t))])])]),b(i(Se),{modelValue:i(y),"onUpdate:modelValue":a[7]||(a[7]=s=>D(y)?y.value=s:null),title:"Settings",width:"80%",center:""},{footer:g(()=>[n("span",null,[b(i(k),{onClick:a[6]||(a[6]=s=>y.value=!1)},{default:g(()=>[B("Close")]),_:1}),b(i(k),{type:"primary",onClick:oe,class:"fix-primary"},{default:g(()=>[B("Preserve")]),_:1})])]),default:g(()=>[n("div",wt,[n("div",ft,[jt,b(i(H),{placeholder:"sk-xxxxxxxxxx",modelValue:i(h),"onUpdate:modelValue":a[4]||(a[4]=s=>D(h)?h.value=s:h=s),size:"large",clearable:""},null,8,["modelValue"])]),n("div",xt,[St,b(i(Ce),{size:"large",class:"w-full",modelValue:i(v),"onUpdate:modelValue":a[5]||(a[5]=s=>D(v)?v.value=s:null)},{default:g(()=>[(l(!0),p(F,null,U(i(t),s=>(l(),G(i(De),{key:s.id,label:s.id,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])],64)}}});export{Lt as default};
