var ge=Object.defineProperty;var ve=(t,e,o)=>e in t?ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var D=(t,e,o)=>ve(t,typeof e!="symbol"?e+"":e,o);import{C as K}from"./vendor/crypto-js-Ci0zXM0r.js";import{E as V,a as he,b as se,c as N,d as we,e as fe,f as xe}from"./vendor/element-plus-Buyz4oKF.js";import{x as f,n as ne,J as h,K as j,Y as c,I as $,q as re,P as je,p as J,W as U,av as ie,a0 as w,_ as S,a6 as _e,aG as Se,X as y,Z as z,u as a,aH as Ce,aI as ke,a4 as Z,a5 as Q,V as F,H as L,ax as Me,aw as q,aJ as Ie,r as De,a9 as Ve,y as Ee,aK as Be}from"./vendor/-DG6odqa_.js";import{l as $e}from"./vendor/lodash-eWJlexCj.js";import{S as Te}from"./vendor/smooth-scroll-DWzhxnP0.js";import{_ as A}from"./index-mQnQowEn.js";import{H as R,j as Le,p as Re,g as Ke,a as Ne,r as ze,s as qe,b as Ae,c as He,l as Pe,d as Fe,x as Oe,e as Je,f as Ue,h as Ge}from"./vendor/highlight.js-Be3YRpZp.js";import{m as de,_ as We}from"./vendor/marked-COKqZZmD.js";import"./vendor/lodash-es-ut2NwUtB.js";import"./vendor/vue-router-BbBv9qpx.js";const Ye=[{id:"text-search-babbage-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k-0613",object:"model",created:1685474247,owned_by:"openai"},{id:"curie-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k",object:"model",created:1683758102,owned_by:"openai-internal"},{id:"text-search-babbage-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"babbage",object:"model",created:1649358449,owned_by:"openai"},{id:"babbage-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-babbage-001",object:"model",created:1649364043,owned_by:"openai"},{id:"text-similarity-davinci-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-1106-preview",object:"model",created:1698957206,owned_by:"system"},{id:"davinci-similarity",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-davinci-edit-001",object:"model",created:1649880484,owned_by:"openai"},{id:"curie-similarity",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"babbage-search-document",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"curie-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"gpt-3.5-turbo",object:"model",created:1677610602,owned_by:"openai"},{id:"gpt-3.5-turbo-1106",object:"model",created:1698959748,owned_by:"system"},{id:"text-search-ada-doc-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"davinci-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"text-similarity-babbage-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-search-davinci-doc-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-similarity",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-embedding-ada-002",object:"model",created:1671217299,owned_by:"openai-internal"},{id:"davinci-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-vision-preview",object:"model",created:1698894917,owned_by:"system"},{id:"text-similarity-curie-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"gpt-4",object:"model",created:1687882411,owned_by:"openai"},{id:"text-davinci-001",object:"model",created:1649364042,owned_by:"openai"},{id:"text-search-davinci-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-search-document",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-code-search-code",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-002",object:"model",created:1692634615,owned_by:"system"},{id:"davinci-002",object:"model",created:1692634301,owned_by:"system"},{id:"davinci-search-document",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"curie-search-document",object:"model",created:1651172508,owned_by:"openai-dev"},{id:"babbage-code-search-code",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-search-ada-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"code-search-ada-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"babbage-code-search-text",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-search-babbage-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-code-search-text",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"tts-1-hd",object:"model",created:1699046015,owned_by:"system"},{id:"text-search-curie-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-002",object:"model",created:1649880484,owned_by:"openai"},{id:"text-davinci-edit-001",object:"model",created:1649809179,owned_by:"openai"},{id:"code-search-babbage-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"tts-1-hd-1106",object:"model",created:1699053533,owned_by:"system"},{id:"gpt-3.5-turbo-instruct-0914",object:"model",created:1694122472,owned_by:"system"},{id:"ada",object:"model",created:1649357491,owned_by:"openai"},{id:"gpt-3.5-turbo-0613",object:"model",created:1686587434,owned_by:"openai"},{id:"text-ada-001",object:"model",created:1649364042,owned_by:"openai"},{id:"ada-similarity",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"code-search-ada-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"text-similarity-ada-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-0301",object:"model",created:1677649963,owned_by:"openai"},{id:"gpt-3.5-turbo-instruct",object:"model",created:1692901427,owned_by:"system"},{id:"gpt-4-0613",object:"model",created:1686588896,owned_by:"openai"},{id:"text-search-curie-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-003",object:"model",created:1669599635,owned_by:"openai-internal"},{id:"text-curie-001",object:"model",created:1649364043,owned_by:"openai"},{id:"whisper-1",object:"model",created:1677532384,owned_by:"openai-internal"},{id:"curie",object:"model",created:1649359874,owned_by:"openai"},{id:"gpt-4-0314",object:"model",created:1687882410,owned_by:"openai"},{id:"canary-tts",object:"model",created:1699492935,owned_by:"system"},{id:"tts-1",object:"model",created:1681940951,owned_by:"openai-internal"},{id:"davinci",object:"model",created:1649359874,owned_by:"openai"},{id:"dall-e-2",object:"model",created:1698798177,owned_by:"system"},{id:"tts-1-1106",object:"model",created:1699053241,owned_by:"system"},{id:"dall-e-3",object:"model",created:1698785189,owned_by:"system"}],ce="SuMingcheng";K.enc.Utf8.parse("ThisIsAnIV123456");function Xe(t){return K.AES.encrypt(t,ce).toString()}function Ze(t){return t==null?"":K.AES.decrypt(t,ce).toString(K.enc.Utf8)}const Qe=new TextDecoder("utf-8"),ee={get(t){return Ze(window.localStorage.getItem(t))},set(t,e){window.localStorage.setItem(t,Xe(e))},remove(t){window.localStorage.removeItem(t)}},te=()=>{window.open("https://github.com/sumingcheng/Vue3-TS-ChatGPT")};function et(t){const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return t.sort((o,r)=>e.compare(o.id,r.id))}function tt(){return{getKey:()=>{const o=ee.get("apiKey");return o===null?"":o},setKey:o=>ee.set("apiKey",o)}}const ot=t=>{navigator.clipboard.writeText(t).then(function(){V({message:"已复制",type:"success"})},function(e){console.error("无法复制文本: ",e)})},oe=()=>{const t=document.getElementsByClassName("copyNode");Array.from(t).forEach(o=>{o.copyAction&&o.removeEventListener("click",o.copyAction),o.copyAction=()=>{ot(o.nextSibling.textContent)},o.addEventListener("click",o.copyAction)})};async function at(t,e,o){try{const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:o,stream:!0,messages:t})});return r.ok?{status:"success",data:r.body}:{status:"error",error:(await r.json()).error}}catch(r){return{status:"error",error:{message:r instanceof Error?r.message:"未知错误"}}}}const le=f(window.innerWidth);window.addEventListener("resize",()=>{le.value=window.innerWidth});const u=ne(()=>le.value<=768),ae=[{role:"system",content:"I want you to act as a professional programmer, providing rigorous and comprehensible answers to my questions. When I present you with a programming query or scenario, respond with the precision and clarity expected of an experienced developer. Ensure your explanations are thorough yet easy to understand, employing technical terminology accurately. Your responses should reflect the expertise and insight of a seasoned programmer, aiding in not just solving the presented issue, but also offering a deeper understanding of the underlying concepts involved."},{role:"assistant",content:"Hello, I am the Magic Conch Shell. Feel free to ask me any questions."}];class k extends Error{constructor(e){super(e),this.name="DatabaseError"}}const M=class M{constructor(){D(this,"dbName","ChatAppDB");D(this,"objectStoreName","chatRecords");D(this,"chatRecordKey","chatRecordKey");D(this,"isIndexedDBSupported","indexedDB"in window);if(M.instance)throw new Error("Use ChatStorageManager.getInstance() instead of new.")}static getInstance(){return M.instance||(M.instance=new M),M.instance}async initDB(){try{return await new Promise((e,o)=>{const r=indexedDB.open(this.dbName,1);r.onerror=()=>o(new k("Failed to open IndexedDB")),r.onsuccess=i=>e(i.target.result),r.onupgradeneeded=i=>{const p=i.target.result;p.objectStoreNames.contains(this.objectStoreName)||p.createObjectStore(this.objectStoreName)}})}catch(e){throw new k(`IndexedDB initialization failed: ${e.message}`)}}async saveChatRecord(e){try{if(this.isIndexedDBSupported){const i=(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName);await new Promise((p,d)=>{const n=i.put(e,this.chatRecordKey);n.onsuccess=()=>p(),n.onerror=()=>d(new k("Failed to save record"))})}else localStorage.setItem(this.chatRecordKey,JSON.stringify(e))}catch(o){throw new k(`Failed to save chat record: ${o.message}`)}}async getChatRecord(){try{if(this.isIndexedDBSupported){const o=await this.initDB();return await new Promise((r,i)=>{const n=o.transaction([this.objectStoreName]).objectStore(this.objectStoreName).get(this.chatRecordKey);n.onerror=()=>i(new k("Failed to fetch record")),n.onsuccess=()=>r(n.result)})}const e=localStorage.getItem(this.chatRecordKey);return e?JSON.parse(e):null}catch(e){throw new k(`Failed to get chat record: ${e.message}`)}}async deleteChatRecord(){try{if(this.isIndexedDBSupported){const r=(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName);await new Promise((i,p)=>{const d=r.delete(this.chatRecordKey);d.onsuccess=()=>i(),d.onerror=()=>p(new k("Failed to delete record"))})}else localStorage.removeItem(this.chatRecordKey)}catch(e){throw new k(`Failed to delete chat record: ${e.message}`)}}};D(M,"instance",null);let O=M;const st="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1688628261553'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7931'%20width='128'%20height='128'%3e%3cpath%20d='M465.130667%20874.837333a42.666667%2042.666667%200%200%200%2073.856%200L934.314667%20192.042667a42.666667%2042.666667%200%200%200-36.928-64H106.730667a42.666667%2042.666667%200%200%200-36.928%2064z'%20fill='%23f7f7f7'%20p-id='7932'%3e%3c/path%3e%3c/svg%3e",nt={},rt={class:"box"};function it(t,e){return h(),j("div",rt,e[0]||(e[0]=[c("div",{class:"loading"},[c("div"),c("div"),c("div"),c("div"),c("div"),c("div"),c("div"),c("div"),c("div")],-1)]))}const dt=A(nt,[["render",it],["__scopeId","data-v-107fce48"]]),H=new We,ct={javascript:Le,python:Re,go:Ke,java:Ne,rust:ze,shell:qe,php:Ae,sql:He,less:Pe,css:Fe,xml:Oe,json:Je,c:Ue,cpp:Ge};for(const[t,e]of Object.entries(ct))R.registerLanguage(t,e);H.text=function(t){return t.startsWith("$")&&t.endsWith("$")?`<span class='math'>${t.slice(1,-1)}</span>`:t};H.paragraph=function(t){return t.startsWith("$$")&&t.endsWith("$$")?`<div class='math'>${t.slice(2,-2)}</div>`:"<p>"+t+`</p>
`};H.code=(t,e)=>{const r=!!(e&&R.getLanguage(e))?R.highlight(t,{language:e}).value:R.highlightAuto(t).value;return`<pre class='clearfix'><button class='copyNode'>Copy</button><code class='${e} hljs'>${r}</code></pre>
`};de.setOptions({renderer:H});const lt=t=>de(t),ut={class:"outer-container h-full"},pt=["innerHTML"],mt=$({__name:"ChatContent",props:{messages:{},roleAlias:{},isMobile:{type:Boolean}},emits:["scroll-bottom"],setup(t,{expose:e,emit:o}){const r=t,i=f(),p=f(!1),d=()=>{if(!i.value)return;const{scrollTop:s,scrollHeight:v,clientHeight:m}=i.value;p.value=v-(s+m)>200},n=()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,p.value=!1)};re(()=>{var s;(s=i.value)==null||s.addEventListener("scroll",d)}),je(()=>{var s;(s=i.value)==null||s.removeEventListener("scroll",d)});const g=ne(()=>s=>lt(s));return J(()=>r.messages,()=>{L(()=>{n()})},{deep:!0}),e({chatListDom:i,scrollToBottom:n}),(s,v)=>(h(),j("div",ut,[c("div",{class:"chat-container h-full overflow-y-auto",ref_key:"chatListDom",ref:i},[(h(!0),j(U,null,ie(s.messages.filter(m=>m.role!=="system"),(m,G,W,C)=>{const E=[m.content,m.role];if(C&&C.key===m.content&&Se(C,E))return C;const T=(h(),j("div",{key:m.content},[c("div",{class:y(["message-wrapper",{"flex-row-reverse":m.role==="user"}])},[c("div",{class:y(["avatar-wrapper",{"mobile-avatar":s.isMobile}])},[w(a(he),{size:s.isMobile?16:20,color:"#000000"},{default:S(()=>[m.role==="user"?(h(),z(a(Ce),{key:0})):(h(),z(a(ke),{key:1}))]),_:2},1032,["size"])],2),c("div",{class:y(["message-content px-6 py-4",[m.role,{"mobile-message":s.isMobile}]])},[Z(c("div",{class:"text-base break-words",innerHTML:g.value(m.content)},null,8,pt),[[Q,m.content]]),Z(w(dt,null,null,512),[[Q,!m.content]])],2)],2)]));return T.memo=E,T},v,0),128)),w(_e,{name:"fade"},{default:S(()=>[p.value?(h(),j("div",{key:0,class:y(["fixed right-6 bottom-32 cursor-pointer bg-black rounded-full shadow-lg hover:bg-opacity-80 transition-all",{"right-3 bottom-24":s.isMobile}]),onClick:n},v[2]||(v[2]=[c("div",{class:"bg-black rounded-full p-2"},[c("img",{src:st,alt:"ReturnToBottom",class:"w-5 h-5"})],-1)]),2)):F("",!0)]),_:1})],512)]))}}),bt=A(mt,[["__scopeId","data-v-fb62536f"]]),yt=$({__name:"ChatInput",props:{isTalking:{type:Boolean},isMobile:{type:Boolean}},emits:["send","delete","scroll-bottom"],setup(t,{expose:e,emit:o}){const r=o,i=f(null),p=f(""),d=s=>{s&&s.preventDefault(),p.value.trim()&&(r("send",p.value),p.value="")};return e({getFocus:()=>{var s;(s=i.value)==null||s.focus()},clearContent:()=>{p.value=""},myInput:i}),(s,v)=>(h(),j("div",{class:y(["flex flex-nowrap fixed w-full bottom-0 z-50 bgColor h-24",{"px-6":!s.isMobile,"px-3":s.isMobile}])},[c("div",{class:y(["flex items-center w-full h-full",{"max-w-3xl mx-auto":s.isMobile}])},[w(a(se),{class:"input flex-1",rows:1,type:"textarea",ref_key:"myInput",ref:i,modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=m=>p.value=m),size:s.isMobile?"default":"large",disabled:s.isTalking,onKeydown:Me(d,["enter"]),style:{"--el-input-text-color":"#000000"}},null,8,["modelValue","size","disabled"]),w(a(N),{onClick:d,size:s.isMobile?"default":"large",type:"info",class:y(["elBtnStyle ml-5",{"text-5xl":!s.isMobile,"text-3xl":s.isMobile}])},{default:S(()=>v[2]||(v[2]=[q(" Send ")])),_:1},8,["size","class"]),c("div",{class:y(["triangle ml-4 cursor-pointer",{"scale-75":s.isMobile}]),onClick:v[1]||(v[1]=m=>r("delete"))},[w(a(Ie))],2)],2)],2))}}),gt=A(yt,[["__scopeId","data-v-bac73820"]]),vt={key:0,class:"ml-4 text-sm text-white"},ht=$({__name:"Header",setup(t){return(e,o)=>(h(),j("div",{class:y(["flex flex-nowrap fixed w-full items-center top-0 bgColor z-50 h-16",{"px-6":!a(u),"px-3":a(u)}])},[c("div",{class:y(["font-bold text-white",{"text-2xl":!a(u),"text-xl":a(u)}])},"MagicConch",2),a(u)?F("",!0):(h(),j("div",vt," Magic conch based on ChatGPT ")),a(u)?F("",!0):(h(),j("div",{key:1,class:"ml-4 my-auto cursor-pointer",onClick:o[0]||(o[0]=(...r)=>a(te)&&a(te)(...r))},o[2]||(o[2]=[c("img",{loading:"lazy",decoding:"async",src:"https://img.shields.io/github/stars/sumingcheng/Vue3-TS-ChatGPT?logo=github",alt:"GitHub"},null,-1)]))),c("div",{class:"ml-auto text-sm cursor-pointer",onClick:o[1]||(o[1]=r=>e.$emit("config"))},[w(a(N),{size:a(u)?"default":"large",type:"info",class:y(["elBtnStyle",{"text-4xl":!a(u),"text-3xl":a(u)}])},{default:S(()=>o[3]||(o[3]=[q("Set")])),_:1},8,["size","class"])])],2))}}),wt=$({__name:"SettingsDialog",props:{modelValue:{type:Boolean},apiKey:{},gptVersion:{},gptVersionList:{},width:{default:u?"90%":"80%"}},emits:["update:modelValue","save"],setup(t,{emit:e}){const o=t,r=e,i=f(o.apiKey),p=f(o.gptVersion);return J(()=>o.modelValue,d=>{d&&(i.value=o.apiKey,p.value=o.gptVersion)}),(d,n)=>(h(),z(a(xe),{"model-value":d.modelValue,"onUpdate:modelValue":n[4]||(n[4]=g=>d.$emit("update:modelValue",g)),width:d.width,center:""},{footer:S(()=>[c("div",{class:y([{"flex gap-2":!a(u),"space-y-2":a(u)}])},[w(a(N),{onClick:n[2]||(n[2]=g=>d.$emit("update:modelValue",!1)),size:a(u)?"default":"large",class:y({"w-full":a(u)})},{default:S(()=>n[7]||(n[7]=[q(" 取消 ")])),_:1},8,["size","class"]),w(a(N),{type:"primary",onClick:n[3]||(n[3]=g=>r("save",i.value,p.value)),size:a(u)?"default":"large",class:y({"w-full":a(u)})},{default:S(()=>n[8]||(n[8]=[q(" 保存 ")])),_:1},8,["size","class"])],2)]),default:S(()=>[c("div",{class:y({"p-6":!a(u),"p-3":a(u)})},[c("div",{class:y(["flex items-center gap-4",{"flex-col items-start":a(u)}])},[n[5]||(n[5]=c("span",{class:"font-bold whitespace-nowrap"},"API Key",-1)),w(a(se),{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=g=>i.value=g),placeholder:"sk-xxxxxxxxxx",size:a(u)?"default":"large",clearable:"",class:y(["flex-1",{"w-full":a(u)}])},null,8,["modelValue","size","class"])],2),c("div",{class:y(["flex items-center gap-4 mt-5",{"flex-col items-start":a(u)}])},[n[6]||(n[6]=c("span",{class:"font-bold whitespace-nowrap"},"Version",-1)),w(a(fe),{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=g=>p.value=g),size:a(u)?"default":"large",class:y(["flex-1",{"w-full":a(u)}])},{default:S(()=>[(h(!0),j(U,null,ie(d.gptVersionList,g=>(h(),z(a(we),{key:g.id,label:g.id,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","size","class"])],2)],2)]),_:1},8,["model-value","width"]))}}),ft=A(wt,[["__scopeId","data-v-89d71597"]]),xt={class:"flex flex-col h-screen"},jt={class:"flex-1 overflow-hidden mt-16 mb-24"},Tt=$({__name:"index",setup(t){const e=et(Ye),o={user:"ME",assistant:"Magic Conch",system:"System"},r=O.getInstance(),{getKey:i,setKey:p}=tt(),d=f(ae),n=f("gpt-3.5-turbo"),g=f(!1),s=f(!1),v=f(),m=f(),G=$e.debounce(()=>{De(()=>{d.value.forEach(l=>{l.content&&l.content.includes("$")&&L(()=>{window.MathJax.typesetPromise()})})})},200),W=()=>{new MutationObserver(b=>{b.forEach(x=>{x.type==="childList"&&window.MathJax&&G()})}).observe(document.body,{childList:!0,subtree:!0})},C=l=>{d.value[d.value.length-1].content+=l},E=async l=>{const{done:b,value:x}=await l.read();if(b){l.releaseLock();return}const B=Qe.decode(x).match(/data: \s*({.*?}]})/g);B&&B.forEach(_=>{const I=_.replace("data: ",""),P=JSON.parse(I);C(P.choices[0].delta.content??"")}),await E(l)},T=async l=>{try{const b=l.data.getReader();await E(b)}catch(b){console.error("Error updating message list:",b)}},ue=async l=>{var b,x,B;try{if(!l){V({message:"请输入内容",type:"info"});return}g.value=!0,d.value.length===2&&d.value.pop(),d.value.push({role:"user",content:l}),d.value.push({role:"assistant",content:""});const _=await at(d.value,i(),n.value);if(_.status==="success"&&_.data)await T(_);else{const X=((b=_.error)==null?void 0:b.message)||"发生未知错误";C(X),V({message:X,type:"error"})}const I=JSON.stringify(d.value),P=JSON.parse(I);await r.saveChatRecord(P)}catch(_){const I=((x=_.error)==null?void 0:x.message)||_.message||"请求失败，请重试";C(I),V({message:I,type:"error"})}finally{g.value=!1,(B=m.value)==null||B.getFocus()}},pe=()=>{s.value=!0},Y=Be(()=>{var x;const l=new Te,b=(x=v.value)==null?void 0:x.chatListDom;b&&l.animateScroll(b.scrollHeight,b)},100),me=()=>{r.deleteChatRecord().then(()=>{console.log("Chat records deleted successfully!")}),d.value=ae},be=(l,b)=>{if(!l){V({message:"请输入API Key",type:"warning"});return}p(l),n.value=b,V({message:"保存成功",type:"success"}),s.value=!1},ye=async()=>{const l=await r.getChatRecord();l&&(d.value=l)};return re(()=>{var l;i()===""&&(s.value=!0),(l=m.value)==null||l.getFocus(),ye(),W(),oe()}),Ve(()=>{L(()=>{oe()})}),J(d,()=>{L(()=>{Y()})},{deep:!0}),(l,b)=>(h(),j(U,null,[c("div",xt,[w(ht,{onConfig:pe}),c("div",jt,[w(bt,{ref_key:"chatContentRef",ref:v,messages:a(d),"role-alias":o,"is-mobile":a(u),onScrollBottom:a(Y)},null,8,["messages","is-mobile","onScrollBottom"])]),w(gt,{ref_key:"chatInputRef",ref:m,"is-talking":a(g),"is-mobile":a(u),onSend:ue,onDelete:me},null,8,["is-talking","is-mobile"])]),w(ft,{modelValue:a(s),"onUpdate:modelValue":b[0]||(b[0]=x=>Ee(s)?s.value=x:null),"api-key":a(i)(),"gpt-version":a(n),"gpt-version-list":a(e),onSave:be},null,8,["modelValue","api-key","gpt-version","gpt-version-list"])],64))}});export{Tt as default};
