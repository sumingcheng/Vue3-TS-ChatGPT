var be=Object.defineProperty;var pe=(e,t,o)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var w=(e,t,o)=>(pe(e,typeof t!="symbol"?t+"":t,o),o);import{o as l,c as p,aj as me,ak as ye,a as n,C as he,r as u,w as ge,Y as ve,n as S,f as _e,u as i,L as R,S as b,Q as g,M as V,ab as G,x as C,ac as we,s as fe,al as B,U as je,P as U,a9 as xe}from"./@vue.14a7b677.js";import{_ as Se}from"./index.d5e1b2e3.js";import{C as T}from"./crypto-js.54e3a8ba.js";import{E as k,a as D,b as H,c as Ce,d as Be,e as De}from"./element-plus.d2cfb5b0.js";import{H as E,j as ke,p as Ee,g as Ie,a as Te,r as Ne,s as Ke,b as Me,c as Re,l as Ve,d as Fe,x as Ae,e as Le,f as $e,h as Pe}from"./highlight.js.243975e6.js";import{m as Z,_ as Oe}from"./marked.71c0c359.js";import{S as qe}from"./smooth-scroll.be9bf7a0.js";import{l as ze}from"./lodash.b3d8180c.js";import"./vue-router.59776677.js";import"./@element-plus.df50e9cf.js";import"./@ctrl.b082b0c1.js";import"./@vueuse.f2d0f84a.js";import"./@popperjs.36402333.js";import"./lodash-es.6aaf5ee5.js";const Je="/Vue3-TS-ChatGPT/assets/3.c13c7547.svg",F=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),W=[{role:"system",content:"I want you to act as a professional programmer, providing rigorous and comprehensible answers to my questions. When I present you with a programming query or scenario, respond with the precision and clarity expected of an experienced developer. Ensure your explanations are thorough yet easy to understand, employing technical terminology accurately. Your responses should reflect the expertise and insight of a seasoned programmer, aiding in not just solving the presented issue, but also offering a deeper understanding of the underlying concepts involved."},{role:"assistant",content:"\u4F60\u597D\uFF0C\u6211\u662F\u795E\u5947\u6D77\u87BA\uFF0C\u6B22\u8FCE\u63D0\u95EE"}],f=class{constructor(){w(this,"dbName","ChatAppDB");w(this,"objectStoreName","chatRecords");w(this,"chatRecordKey","chatRecordKey");w(this,"isIndexedDBSupported","indexedDB"in window)}static getInstance(){return f.instance||(f.instance=new f),f.instance}initDB(){return new Promise((t,o)=>{const c=indexedDB.open(this.dbName,1);c.onerror=m=>{o("Failed to open IndexedDB")},c.onsuccess=m=>{t(m.target.result)},c.onupgradeneeded=m=>{const j=m.target.result;j.objectStoreNames.contains(this.objectStoreName)||j.createObjectStore(this.objectStoreName)}})}async saveChatRecord(t){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).put(t,this.chatRecordKey):localStorage.setItem(this.chatRecordKey,JSON.stringify(t))}async getChatRecord(){if(this.isIndexedDBSupported){const t=await this.initDB();return new Promise((o,c)=>{const r=t.transaction([this.objectStoreName]).objectStore(this.objectStoreName).get(this.chatRecordKey);r.onerror=v=>{c("Failed to fetch record from IndexedDB")},r.onsuccess=v=>{o(r.result)}})}else{const t=localStorage.getItem(this.chatRecordKey);return t?JSON.parse(t):null}}async deleteChatRecord(){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).delete(this.chatRecordKey):localStorage.removeItem(this.chatRecordKey)}};let I=f;w(I,"instance");const Ge={},Ue=e=>(me("data-v-107fce48"),e=e(),ye(),e),He={class:"box"},We=Ue(()=>n("div",{class:"loading"},[n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div"),n("div")],-1)),Ye=[We];function Qe(e,t){return l(),p("div",He,Ye)}const Xe=Se(Ge,[["render",Qe],["__scopeId","data-v-107fce48"]]);async function Ze(e,t,o){try{return{status:"success",data:(await fetch("https://api.openai.com/v1/chat/completions",{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,stream:!0,messages:e})})).body}}catch(c){return{status:"error",message:c}}}const ee="SuMingcheng";T.enc.Utf8.parse("ThisIsAnIV123456");function et(e){return T.AES.encrypt(e,ee).toString()}function tt(e){return e==null?"":T.AES.decrypt(e,ee).toString(T.enc.Utf8)}const ot=new TextDecoder("utf-8"),Y={get(e){return tt(window.localStorage.getItem(e))},set(e,t){window.localStorage.setItem(e,et(t))},remove(e){window.localStorage.removeItem(e)}},Q=()=>{window.open("https://github.com/sumingcheng/Vue3-TS-ChatGPT")};function at(e){const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return e.sort((o,c)=>t.compare(o.id,c.id))}function st(){return{getKey:()=>{const o=Y.get("apiKey");return o===null?"":o},setKey:o=>Y.set("apiKey",o)}}const nt=e=>{navigator.clipboard.writeText(e).then(function(){k({message:"\u5DF2\u590D\u5236",type:"success"})},function(t){console.error("\u65E0\u6CD5\u590D\u5236\u6587\u672C: ",t)})},X=()=>{const e=document.getElementsByClassName("copyNode");Array.from(e).forEach(o=>{o.copyAction&&o.removeEventListener("click",o.copyAction),o.copyAction=()=>{nt(o.nextSibling.textContent)},o.addEventListener("click",o.copyAction)})},N=new Oe,dt={javascript:ke,python:Ee,go:Ie,java:Te,rust:Ne,shell:Ke,php:Me,sql:Re,less:Ve,css:Fe,xml:Ae,json:Le,c:$e,cpp:Pe};for(const[e,t]of Object.entries(dt))E.registerLanguage(e,t);N.text=function(e){return e.startsWith("$")&&e.endsWith("$")?`<span class='math'>${e.slice(1,-1)}</span>`:e};N.paragraph=function(e){return e.startsWith("$$")&&e.endsWith("$$")?`<div class='math'>${e.slice(2,-2)}</div>`:"<p>"+e+`</p>
`};N.code=(e,t)=>{const c=!!(t&&E.getLanguage(t))?E.highlight(e,{language:t}).value:E.highlightAuto(e).value;return`<pre class='clearfix'><button class='copyNode'>Copy</button><code class='${t} hljs'>${c}</code></pre>
`};Z.setOptions({renderer:N});const it=e=>Z(e),ct=[{id:"text-search-babbage-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k-0613",object:"model",created:1685474247,owned_by:"openai"},{id:"curie-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k",object:"model",created:1683758102,owned_by:"openai-internal"},{id:"text-search-babbage-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"babbage",object:"model",created:1649358449,owned_by:"openai"},{id:"babbage-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-babbage-001",object:"model",created:1649364043,owned_by:"openai"},{id:"text-similarity-davinci-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-1106-preview",object:"model",created:1698957206,owned_by:"system"},{id:"davinci-similarity",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-davinci-edit-001",object:"model",created:1649880484,owned_by:"openai"},{id:"curie-similarity",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"babbage-search-document",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"curie-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"gpt-3.5-turbo",object:"model",created:1677610602,owned_by:"openai"},{id:"gpt-3.5-turbo-1106",object:"model",created:1698959748,owned_by:"system"},{id:"text-search-ada-doc-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"davinci-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"text-similarity-babbage-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-search-davinci-doc-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-similarity",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-embedding-ada-002",object:"model",created:1671217299,owned_by:"openai-internal"},{id:"davinci-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-vision-preview",object:"model",created:1698894917,owned_by:"system"},{id:"text-similarity-curie-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"gpt-4",object:"model",created:1687882411,owned_by:"openai"},{id:"text-davinci-001",object:"model",created:1649364042,owned_by:"openai"},{id:"text-search-davinci-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-search-document",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-code-search-code",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-002",object:"model",created:1692634615,owned_by:"system"},{id:"davinci-002",object:"model",created:1692634301,owned_by:"system"},{id:"davinci-search-document",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"curie-search-document",object:"model",created:1651172508,owned_by:"openai-dev"},{id:"babbage-code-search-code",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-search-ada-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"code-search-ada-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"babbage-code-search-text",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-search-babbage-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-code-search-text",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"tts-1-hd",object:"model",created:1699046015,owned_by:"system"},{id:"text-search-curie-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-002",object:"model",created:1649880484,owned_by:"openai"},{id:"text-davinci-edit-001",object:"model",created:1649809179,owned_by:"openai"},{id:"code-search-babbage-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"tts-1-hd-1106",object:"model",created:1699053533,owned_by:"system"},{id:"gpt-3.5-turbo-instruct-0914",object:"model",created:1694122472,owned_by:"system"},{id:"ada",object:"model",created:1649357491,owned_by:"openai"},{id:"gpt-3.5-turbo-0613",object:"model",created:1686587434,owned_by:"openai"},{id:"text-ada-001",object:"model",created:1649364042,owned_by:"openai"},{id:"ada-similarity",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"code-search-ada-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"text-similarity-ada-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-0301",object:"model",created:1677649963,owned_by:"openai"},{id:"gpt-3.5-turbo-instruct",object:"model",created:1692901427,owned_by:"system"},{id:"gpt-4-0613",object:"model",created:1686588896,owned_by:"openai"},{id:"text-search-curie-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-003",object:"model",created:1669599635,owned_by:"openai-internal"},{id:"text-curie-001",object:"model",created:1649364043,owned_by:"openai"},{id:"whisper-1",object:"model",created:1677532384,owned_by:"openai-internal"},{id:"curie",object:"model",created:1649359874,owned_by:"openai"},{id:"gpt-4-0314",object:"model",created:1687882410,owned_by:"openai"},{id:"canary-tts",object:"model",created:1699492935,owned_by:"system"},{id:"tts-1",object:"model",created:1681940951,owned_by:"openai-internal"},{id:"davinci",object:"model",created:1649359874,owned_by:"openai"},{id:"dall-e-2",object:"model",created:1698798177,owned_by:"system"},{id:"tts-1-1106",object:"model",created:1699053241,owned_by:"system"},{id:"dall-e-3",object:"model",created:1698785189,owned_by:"system"}],rt={class:"flex flex-col h-screen relative"},lt={class:"flex flex-nowrap fixed w-full items-baseline top-0 px-6 py-4 bgColor z-50"},ut=n("div",{class:"text-2xl font-bold text-white"},"MagicConch",-1),bt={key:0,class:"ml-4 text-sm text-white"},pt=n("img",{loading:"lazy",src:"https://img.shields.io/github/stars/sumingcheng/Vue3-TS-ChatGPT?logo=github",alt:"GitHub"},null,-1),mt=[pt],yt={class:"flex-1 mt-16 content",ref:"observedDiv"},ht={class:"font-bold mb-3 text-lg"},gt=["innerHTML"],vt={class:"flex flex-nowrap fixed w-full p-6 bgColor bottom-0 z-50"},_t={class:"flex items-center w-full"},wt=n("img",{src:Je,alt:"ReturnToBottom"},null,-1),ft=[wt],jt={class:"bottom-0 w-full p-6 pb-8"},xt={class:"flex items-center"},St=n("span",{class:"w-1/6 font-bold"},"API Key",-1),Ct={class:"flex items-center mt-5"},Bt=n("span",{class:"w-1/6 font-bold"},"Version",-1),Ot=he({__name:"home",setup(e){const t=at(ct),o=I.getInstance(),{getKey:c,setKey:m}=st(),j={user:"ME",assistant:"Magic Conch",system:"System"},r=u(W),v=u("gpt-3.5-turbo");let K=u(!1);const M=u(null),y=u(!1),A=u();u(!1);let _=u(""),h=u("");const L=()=>{window.MathJax?te():setTimeout(L,100)},te=()=>{fe(()=>{r.value.forEach(d=>{d.content&&d.content.includes("$")&&S(()=>{window.MathJax.typesetPromise()})})})},oe=()=>{if(!h.value){k({message:"\u8BF7\u8F93\u5165API Key",type:"warning"});return}m(h.value),k({message:"\u4FDD\u5B58\u6210\u529F",type:"success"}),y.value=!1},ae=()=>{_.value=""},$=d=>{r.value[r.value.length-1].content+=d},se=async d=>{try{const a=d.data.getReader();await P(a)}catch(a){console.error("Error updating message list:",a)}},P=async d=>{const{done:a,value:x}=await d.read();if(a){d.releaseLock();return}const s=ot.decode(x).match(/data: \s*({.*?}]})/g);s&&s.forEach(re=>{var J;const le=re.replace("data: ",""),ue=JSON.parse(le);$((J=ue.choices[0].delta.content)!=null?J:"")}),await P(d)},O=async(d=_.value)=>{if(!d){k({message:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"info"});return}K.value=!0,r.value.length===2&&r.value.pop(),r.value.push({role:"user",content:d}),ae(),r.value.push({role:"assistant",content:""});const a=await Ze(r.value,c(),v.value);a.status==="success"&&a.data?await se(a):$(a.message),K.value=!1,q();const x=JSON.stringify(r.value),s=JSON.parse(x);o.saveChatRecord(s).then(()=>{console.log("Chat records saved successfully!")})},q=()=>{S(()=>{M.value&&M.value.focus()})},ne=()=>{y.value=!0;let d=c();d&&(h.value=d)},z=()=>{const d=new qe,a=A.value;a&&d.animateScroll(a.scrollHeight,a)},de=()=>{o.deleteChatRecord().then(()=>{console.log("Chat records deleted successfully!")}),r.value=W},ie=async()=>{const d=await o.getChatRecord();d&&(r.value=d)},ce=ze.exports.debounce(z,200);return ge(r,()=>{console.log("goToTheBottom()",r.value),S(()=>{ce()})},{deep:!0,immediate:!0}),ve(()=>{S(()=>{X()})}),_e(()=>{c()===""&&(y.value=!0),q(),ie(),L(),X()}),(d,a)=>{const x=xe("DeleteFilled");return l(),p(V,null,[n("div",rt,[n("div",lt,[ut,i(F)?R("",!0):(l(),p("div",bt," Magic conch based on ChatGPT ")),i(F)?R("",!0):(l(),p("div",{key:1,class:"ml-4 my-auto cursor-pointer",onClick:a[0]||(a[0]=(...s)=>i(Q)&&i(Q)(...s))},mt)),n("div",{class:"ml-auto text-sm cursor-pointer",onClick:ne},[b(i(D),{size:"large",type:"info",class:"elBtnStyle text-4xl"},{default:g(()=>[B("Settings")]),_:1})])]),n("div",yt,[n("div",{class:"mx-10 mt-6 mb-24",ref_key:"chatListDom",ref:A},[(l(!0),p(V,null,G(i(r).filter(s=>s.role!=="system"),s=>(l(),p("div",null,[n("div",ht,je(j[s.role])+"\uFF1A",1),s.content?(l(),p("div",{key:0,class:"text-base text-black whitespace-pre-wrap",innerHTML:i(it)(s.content.replace(/^\n\n/,""))},null,8,gt)):(l(),U(Xe,{key:1}))]))),256))],512)],512),n("div",vt,[n("div",_t,[b(i(H),{class:"input",rows:1,type:"textarea",ref_key:"myInput",ref:M,modelValue:i(_),"onUpdate:modelValue":a[1]||(a[1]=s=>C(_)?_.value=s:_=s),size:"large",onKeydown:a[2]||(a[2]=we(s=>O(),["enter"])),disabled:i(K)},null,8,["modelValue","disabled"]),b(i(D),{onClick:a[3]||(a[3]=s=>O()),size:"large",type:"info",class:"elBtnStyle text-5xl ml-5"},{default:g(()=>[B("Send")]),_:1}),n("div",{class:"triangle ml-4 cursor-pointer",onClick:de},[b(x)]),i(F)?R("",!0):(l(),p("div",{key:0,class:"triangle ml-4 cursor-pointer",onClick:z},ft))])])]),b(i(Ce),{modelValue:i(y),"onUpdate:modelValue":a[7]||(a[7]=s=>C(y)?y.value=s:null),title:"Settings",width:"80%",center:""},{footer:g(()=>[n("span",null,[b(i(D),{onClick:a[6]||(a[6]=s=>y.value=!1)},{default:g(()=>[B("Close")]),_:1}),b(i(D),{type:"primary",onClick:oe,class:"fix-primary"},{default:g(()=>[B("Preserve")]),_:1})])]),default:g(()=>[n("div",jt,[n("div",xt,[St,b(i(H),{placeholder:"sk-xxxxxxxxxx",modelValue:i(h),"onUpdate:modelValue":a[4]||(a[4]=s=>C(h)?h.value=s:h=s),size:"large",clearable:""},null,8,["modelValue"])]),n("div",Ct,[Bt,b(i(Be),{size:"large",class:"w-full",modelValue:i(v),"onUpdate:modelValue":a[5]||(a[5]=s=>C(v)?v.value=s:null)},{default:g(()=>[(l(!0),p(V,null,G(i(t),s=>(l(),U(i(De),{key:s.id,label:s.id,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])],64)}}});export{Ot as default};
