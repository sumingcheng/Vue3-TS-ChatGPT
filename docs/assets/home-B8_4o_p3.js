var me=Object.defineProperty;var ye=(e,t,a)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var x=(e,t,a)=>ye(e,typeof t!="symbol"?t+"":t,a);import{o as p,f as v,g as s,C as D,h as k,H as B,m as X,_ as ge,j as ve,p as he,i as we,k as fe,l as je,s as xe,n as _e,q as Se,t as Ce,u as ke,x as Be,v as De,y as Te,z as Ve,A as Z,B as g,c as U,w,D as d,a as m,F as T,G as V,I as ee,J as te,K as Ie,L as R,M as Ee,N as Ne,O as z,P as Re,Q as Ke,R as Le,T as C,U as Me,V as E,W as G,X as $e,Y as Ae,Z as Pe,$ as J,a0 as H,a1 as Oe}from"./.pnpm-C-Juv5e-.js";import{_ as qe}from"./index-e9WLBaCb.js";const Ue="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1688628261553'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7931'%20width='128'%20height='128'%3e%3cpath%20d='M465.130667%20874.837333a42.666667%2042.666667%200%200%200%2073.856%200L934.314667%20192.042667a42.666667%2042.666667%200%200%200-36.928-64H106.730667a42.666667%2042.666667%200%200%200-36.928%2064z'%20fill='%23f7f7f7'%20p-id='7932'%3e%3c/path%3e%3c/svg%3e",N=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),W=[{role:"system",content:"I want you to act as a professional programmer, providing rigorous and comprehensible answers to my questions. When I present you with a programming query or scenario, respond with the precision and clarity expected of an experienced developer. Ensure your explanations are thorough yet easy to understand, employing technical terminology accurately. Your responses should reflect the expertise and insight of a seasoned programmer, aiding in not just solving the presented issue, but also offering a deeper understanding of the underlying concepts involved."},{role:"assistant",content:"你好，我是神奇海螺，欢迎提问"}],f=class f{constructor(){x(this,"dbName","ChatAppDB");x(this,"objectStoreName","chatRecords");x(this,"chatRecordKey","chatRecordKey");x(this,"isIndexedDBSupported","indexedDB"in window)}static getInstance(){return f.instance||(f.instance=new f),f.instance}initDB(){return new Promise((t,a)=>{const n=indexedDB.open(this.dbName,1);n.onerror=u=>{a("Failed to open IndexedDB")},n.onsuccess=u=>{t(u.target.result)},n.onupgradeneeded=u=>{const y=u.target.result;y.objectStoreNames.contains(this.objectStoreName)||y.createObjectStore(this.objectStoreName)}})}async saveChatRecord(t){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).put(t,this.chatRecordKey):localStorage.setItem(this.chatRecordKey,JSON.stringify(t))}async getChatRecord(){if(this.isIndexedDBSupported){const t=await this.initDB();return new Promise((a,n)=>{const c=t.transaction([this.objectStoreName]).objectStore(this.objectStoreName).get(this.chatRecordKey);c.onerror=()=>{n("Failed to fetch record from IndexedDB")},c.onsuccess=()=>{a(c.result)}})}else{const t=localStorage.getItem(this.chatRecordKey);return t?JSON.parse(t):null}}async deleteChatRecord(){this.isIndexedDBSupported?(await this.initDB()).transaction([this.objectStoreName],"readwrite").objectStore(this.objectStoreName).delete(this.chatRecordKey):localStorage.removeItem(this.chatRecordKey)}};x(f,"instance");let K=f;const ze={},Ge={class:"box"};function Je(e,t){return p(),v("div",Ge,t[0]||(t[0]=[s("div",{class:"loading"},[s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div")],-1)]))}const He=qe(ze,[["render",Je],["__scopeId","data-v-107fce48"]]);async function We(e,t,a){try{const n="https://api.openai.com/v1/chat/completions";return console.log("baseURL",n),{status:"success",data:(await fetch(n,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:a,stream:!0,messages:e})})).body}}catch(n){return{status:"error",message:n}}}const oe="SuMingcheng";D.enc.Utf8.parse("ThisIsAnIV123456");function Fe(e){return D.AES.encrypt(e,oe).toString()}function Ye(e){return e==null?"":D.AES.decrypt(e,oe).toString(D.enc.Utf8)}const Qe=new TextDecoder("utf-8"),F={get(e){return Ye(window.localStorage.getItem(e))},set(e,t){window.localStorage.setItem(e,Fe(t))},remove(e){window.localStorage.removeItem(e)}},Y=()=>{window.open("https://github.com/sumingcheng/Vue3-TS-ChatGPT")};function Xe(e){const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return e.sort((a,n)=>t.compare(a.id,n.id))}function Ze(){return{getKey:()=>{const a=F.get("apiKey");return a===null?"":a},setKey:a=>F.set("apiKey",a)}}const et=e=>{navigator.clipboard.writeText(e).then(function(){k({message:"已复制",type:"success"})},function(t){console.error("无法复制文本: ",t)})},Q=()=>{const e=document.getElementsByClassName("copyNode");Array.from(e).forEach(a=>{a.copyAction&&a.removeEventListener("click",a.copyAction),a.copyAction=()=>{et(a.nextSibling.textContent)},a.addEventListener("click",a.copyAction)})},I=new ge,tt={javascript:ve,python:he,go:we,java:fe,rust:je,shell:xe,php:_e,sql:Se,less:Ce,css:ke,xml:Be,json:De,c:Te,cpp:Ve};for(const[e,t]of Object.entries(tt))B.registerLanguage(e,t);I.text=function(e){return e.startsWith("$")&&e.endsWith("$")?`<span class='math'>${e.slice(1,-1)}</span>`:e};I.paragraph=function(e){return e.startsWith("$$")&&e.endsWith("$$")?`<div class='math'>${e.slice(2,-2)}</div>`:"<p>"+e+`</p>
`};I.code=(e,t)=>{const n=!!(t&&B.getLanguage(t))?B.highlight(e,{language:t}).value:B.highlightAuto(e).value;return`<pre class='clearfix'><button class='copyNode'>Copy</button><code class='${t} hljs'>${n}</code></pre>
`};X.setOptions({renderer:I});const ot=e=>X(e),at=[{id:"text-search-babbage-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k-0613",object:"model",created:1685474247,owned_by:"openai"},{id:"curie-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-16k",object:"model",created:1683758102,owned_by:"openai-internal"},{id:"text-search-babbage-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"babbage",object:"model",created:1649358449,owned_by:"openai"},{id:"babbage-search-query",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-babbage-001",object:"model",created:1649364043,owned_by:"openai"},{id:"text-similarity-davinci-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-1106-preview",object:"model",created:1698957206,owned_by:"system"},{id:"davinci-similarity",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-davinci-edit-001",object:"model",created:1649880484,owned_by:"openai"},{id:"curie-similarity",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"babbage-search-document",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"curie-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"gpt-3.5-turbo",object:"model",created:1677610602,owned_by:"openai"},{id:"gpt-3.5-turbo-1106",object:"model",created:1698959748,owned_by:"system"},{id:"text-search-ada-doc-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"davinci-instruct-beta",object:"model",created:1649364042,owned_by:"openai"},{id:"text-similarity-babbage-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-search-davinci-doc-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-similarity",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"text-embedding-ada-002",object:"model",created:1671217299,owned_by:"openai-internal"},{id:"davinci-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-4-vision-preview",object:"model",created:1698894917,owned_by:"system"},{id:"text-similarity-curie-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"gpt-4",object:"model",created:1687882411,owned_by:"openai"},{id:"text-davinci-001",object:"model",created:1649364042,owned_by:"openai"},{id:"text-search-davinci-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-search-document",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-code-search-code",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"babbage-002",object:"model",created:1692634615,owned_by:"system"},{id:"davinci-002",object:"model",created:1692634301,owned_by:"system"},{id:"davinci-search-document",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"curie-search-document",object:"model",created:1651172508,owned_by:"openai-dev"},{id:"babbage-code-search-code",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-search-ada-query-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"code-search-ada-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"babbage-code-search-text",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"code-search-babbage-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"ada-search-query",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"ada-code-search-text",object:"model",created:1651172510,owned_by:"openai-dev"},{id:"tts-1-hd",object:"model",created:1699046015,owned_by:"system"},{id:"text-search-curie-query-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-002",object:"model",created:1649880484,owned_by:"openai"},{id:"text-davinci-edit-001",object:"model",created:1649809179,owned_by:"openai"},{id:"code-search-babbage-text-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"tts-1-hd-1106",object:"model",created:1699053533,owned_by:"system"},{id:"gpt-3.5-turbo-instruct-0914",object:"model",created:1694122472,owned_by:"system"},{id:"ada",object:"model",created:1649357491,owned_by:"openai"},{id:"gpt-3.5-turbo-0613",object:"model",created:1686587434,owned_by:"openai"},{id:"text-ada-001",object:"model",created:1649364042,owned_by:"openai"},{id:"ada-similarity",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"code-search-ada-code-001",object:"model",created:1651172507,owned_by:"openai-dev"},{id:"text-similarity-ada-001",object:"model",created:1651172505,owned_by:"openai-dev"},{id:"gpt-3.5-turbo-0301",object:"model",created:1677649963,owned_by:"openai"},{id:"gpt-3.5-turbo-instruct",object:"model",created:1692901427,owned_by:"system"},{id:"gpt-4-0613",object:"model",created:1686588896,owned_by:"openai"},{id:"text-search-curie-doc-001",object:"model",created:1651172509,owned_by:"openai-dev"},{id:"text-davinci-003",object:"model",created:1669599635,owned_by:"openai-internal"},{id:"text-curie-001",object:"model",created:1649364043,owned_by:"openai"},{id:"whisper-1",object:"model",created:1677532384,owned_by:"openai-internal"},{id:"curie",object:"model",created:1649359874,owned_by:"openai"},{id:"gpt-4-0314",object:"model",created:1687882410,owned_by:"openai"},{id:"canary-tts",object:"model",created:1699492935,owned_by:"system"},{id:"tts-1",object:"model",created:1681940951,owned_by:"openai-internal"},{id:"davinci",object:"model",created:1649359874,owned_by:"openai"},{id:"dall-e-2",object:"model",created:1698798177,owned_by:"system"},{id:"tts-1-1106",object:"model",created:1699053241,owned_by:"system"},{id:"dall-e-3",object:"model",created:1698785189,owned_by:"system"}],st={class:"bottom-0 w-full p-6 pb-8"},nt={class:"flex items-center"},dt={class:"flex items-center mt-5"},it=Z({__name:"SettingsDialog",props:{visible:{type:Boolean},apiKey:{},gptVersion:{},gptVersionList:{}},emits:["update:visible","save"],setup(e,{emit:t}){const a=e,n=t,u=g(a.apiKey),y=g(a.gptVersion),c=()=>{n("update:visible",!1)},_=()=>{n("save",u.value,y.value)};return(h,l)=>(p(),U(d(Ne),{modelValue:h.visible,"onUpdate:modelValue":l[2]||(l[2]=b=>h.visible=b),title:"Settings",width:"80%",center:"","onUpdate:visible":c},{footer:w(()=>[s("span",null,[m(d(V),{onClick:c},{default:w(()=>l[5]||(l[5]=[T("Close")])),_:1}),m(d(V),{type:"primary",onClick:_,class:"fix-primary"},{default:w(()=>l[6]||(l[6]=[T("Preserve")])),_:1})])]),default:w(()=>[s("div",st,[s("div",nt,[l[3]||(l[3]=s("span",{class:"w-1/6 font-bold"},"API Key",-1)),m(d(ee),{placeholder:"sk-xxxxxxxxxx",modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=b=>u.value=b),size:"large",clearable:""},null,8,["modelValue"])]),s("div",dt,[l[4]||(l[4]=s("span",{class:"w-1/6 font-bold"},"Version",-1)),m(d(Ee),{size:"large",class:"w-full",modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=b=>y.value=b)},{default:w(()=>[(p(!0),v(R,null,te(h.gptVersionList,b=>(p(),U(d(Ie),{key:b.id,label:b.id,value:b.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]))}}),ct={class:"flex flex-col h-screen relative"},rt={class:"flex flex-nowrap fixed w-full items-baseline top-0 px-6 py-4 bgColor z-50"},lt={key:0,class:"ml-4 text-sm text-white"},bt={class:"flex-1 mt-16 content",ref:"observedDiv"},ut={class:"font-bold mb-3 text-lg"},pt=["innerHTML"],mt={class:"flex flex-nowrap fixed w-full p-6 bgColor bottom-0 z-50"},yt={class:"flex items-center w-full"},wt=Z({__name:"home",setup(e){const t=Xe(at),a=K.getInstance(),{getKey:n,setKey:u}=Ze(),y={user:"ME",assistant:"Magic Conch",system:"System"},c=g(W),_=g("gpt-3.5-turbo");let h=g(!1);const l=g(null),b=g(!1),L=g();let j=g("");const M=()=>{window.MathJax?ae():setTimeout(M,100)},ae=z.debounce(()=>{Re(()=>{c.value.forEach(i=>{i.content&&i.content.includes("$")&&C(()=>{window.MathJax.typesetPromise()})})})},200),se=()=>{j.value=""},$=i=>{c.value[c.value.length-1].content+=i},ne=async i=>{try{const o=i.data.getReader();await A(o)}catch(o){console.error("Error updating message list:",o)}},A=async i=>{const{done:o,value:r}=await i.read();if(o){i.releaseLock();return}const S=Qe.decode(r).match(/data: \s*({.*?}]})/g);S&&S.forEach(be=>{const ue=be.replace("data: ",""),pe=JSON.parse(ue);$(pe.choices[0].delta.content??"")}),await A(i)},P=async(i=j.value)=>{if(!i){k({message:"请输入内容",type:"info"});return}h.value=!0,c.value.length===2&&c.value.pop(),c.value.push({role:"user",content:i}),se(),c.value.push({role:"assistant",content:""});const o=await We(c.value,n(),_.value);o.status==="success"&&o.data?await ne(o):$(o.message),h.value=!1,O();const r=JSON.stringify(c.value),S=JSON.parse(r);a.saveChatRecord(S).then(()=>{console.log("Chat records saved successfully!")})},O=()=>{C(()=>{l.value&&l.value.focus()})},de=()=>{b.value=!0},q=()=>{const i=new Ae,o=L.value;o&&i.animateScroll(o.scrollHeight,o)},ie=()=>{a.deleteChatRecord().then(()=>{console.log("Chat records deleted successfully!")}),c.value=W},ce=async()=>{const i=await a.getChatRecord();i&&(c.value=i)},re=z.debounce(q,100);Ke(c,()=>{console.log("goToTheBottom()",c.value),C(()=>{re()})},{deep:!0,immediate:!0}),Le(()=>{C(()=>{Q()})}),Me(()=>{n()===""&&(b.value=!0),O(),ce(),M(),Q()});const le=(i,o)=>{if(!i){k({message:"请输入API Key",type:"warning"});return}u(i),_.value=o,k({message:"保存成功",type:"success"}),b.value=!1};return(i,o)=>(p(),v(R,null,[s("div",ct,[s("div",rt,[o[7]||(o[7]=s("div",{class:"text-2xl font-bold text-white"},"MagicConch",-1)),d(N)?E("",!0):(p(),v("div",lt," Magic conch based on ChatGPT ")),d(N)?E("",!0):(p(),v("div",{key:1,class:"ml-4 my-auto cursor-pointer",onClick:o[0]||(o[0]=(...r)=>d(Y)&&d(Y)(...r))},o[5]||(o[5]=[s("img",{loading:"lazy",src:"https://img.shields.io/github/stars/sumingcheng/Vue3-TS-ChatGPT?logo=github",alt:"GitHub"},null,-1)]))),s("div",{class:"ml-auto text-sm cursor-pointer",onClick:de},[m(d(V),{size:"large",type:"info",class:"elBtnStyle text-4xl"},{default:w(()=>o[6]||(o[6]=[T("Settings")])),_:1})])]),s("div",bt,[s("div",{class:"mx-10 mt-6 mb-24",ref_key:"chatListDom",ref:L},[(p(!0),v(R,null,te(d(c).filter(r=>r.role!=="system"),r=>(p(),v("div",{key:r.content},[s("div",ut,Pe(y[r.role])+"：",1),J(s("div",{class:"text-base text-black whitespace-pre-wrap",innerHTML:d(ot)(r.content.replace(/^\n\n/,""))},null,8,pt),[[H,r.content]]),J(m(He,null,null,512),[[H,!r.content]])]))),128))],512)],512),s("div",mt,[s("div",yt,[m(d(ee),{class:"input",rows:1,type:"textarea",ref_key:"myInput",ref:l,modelValue:d(j),"onUpdate:modelValue":o[1]||(o[1]=r=>G(j)?j.value=r:j=r),size:"large",onKeydown:o[2]||(o[2]=$e(r=>P(),["enter"])),disabled:d(h),style:{"--el-input-text-color":"#000000"}},null,8,["modelValue","disabled"]),m(d(V),{onClick:o[3]||(o[3]=r=>P()),size:"large",type:"info",class:"elBtnStyle text-5xl ml-5"},{default:w(()=>o[8]||(o[8]=[T("Send ")])),_:1}),s("div",{class:"triangle ml-4 cursor-pointer",onClick:ie},[m(d(Oe))]),d(N)?E("",!0):(p(),v("div",{key:0,class:"triangle ml-4 cursor-pointer",onClick:q},o[9]||(o[9]=[s("img",{src:Ue,alt:"ReturnToBottom"},null,-1)])))])])]),m(it,{visible:d(b),"onUpdate:visible":o[4]||(o[4]=r=>G(b)?b.value=r:null),"api-key":d(n)(),"gpt-version":d(_),"gpt-version-list":d(t),onSave:le},null,8,["visible","api-key","gpt-version","gpt-version-list"])],64))}});export{wt as default};
